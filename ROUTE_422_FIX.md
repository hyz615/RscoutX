# ğŸ”§ 422 é”™è¯¯ä¿®å¤ - API è·¯ç”±å†²çª

## âŒ é”™è¯¯ä¿¡æ¯

```
INFO: 127.0.0.1:8952 - "GET /api/matches/sync?team=16610A&event=ALL&scraper=robotevents HTTP/1.1" 422 Unprocessable Entity
```

---

## ğŸ” é—®é¢˜åŸå› 

**FastAPI è·¯ç”±ä¼˜å…ˆçº§é—®é¢˜ï¼š**

```python
# âŒ é”™è¯¯çš„è·¯ç”±é¡ºåº
@router.get("/")                    # 1. åˆ—è¡¨è·¯ç”±
@router.get("/{match_id}")          # 2. åŠ¨æ€è·¯ç”± - åŒ¹é…ä»»ä½•å­—ç¬¦ä¸²ï¼
@router.get("/sync")                # 3. æ°¸è¿œä¸ä¼šè¢«åŒ¹é…åˆ°ï¼
@router.get("/stats/{team_id}")     # 4. ä¹Ÿæœ‰é—®é¢˜
```

å½“è¯·æ±‚ `/api/matches/sync` æ—¶ï¼š
1. FastAPI é¦–å…ˆæ£€æŸ¥ `/` - ä¸åŒ¹é…
2. ç„¶åæ£€æŸ¥ `/{match_id}` - **åŒ¹é…ï¼** å°† "sync" å½“ä½œ match_id
3. å°è¯•å°† "sync" è½¬æ¢ä¸º `int` - **å¤±è´¥ï¼**
4. è¿”å› 422 Unprocessable Entity

**FastAPI è·¯ç”±åŒ¹é…è§„åˆ™ï¼š**
- æŒ‰ç…§å®šä¹‰é¡ºåºåŒ¹é…
- åŠ¨æ€è·¯ç”±ï¼ˆå¦‚ `/{id}`ï¼‰ä¼šåŒ¹é…ä»»ä½•å­—ç¬¦ä¸²
- å…·ä½“è·¯ç”±ï¼ˆå¦‚ `/sync`ï¼‰å¿…é¡»åœ¨åŠ¨æ€è·¯ç”±ä¹‹å‰å®šä¹‰

---

## âœ… è§£å†³æ–¹æ¡ˆ

**æ­£ç¡®çš„è·¯ç”±é¡ºåºï¼š**

```python
# âœ… æ­£ç¡®çš„è·¯ç”±é¡ºåº
@router.get("/sync")                # 1. å…·ä½“è·¯ç”±å…ˆå®šä¹‰
@router.get("/stats/{team_id}")     # 2. å…¶ä»–å…·ä½“è·¯ç”±
@router.get("/")                    # 3. åˆ—è¡¨è·¯ç”±
@router.get("/{match_id}")          # 4. åŠ¨æ€è·¯ç”±æœ€å
```

**åŸåˆ™ï¼š**
1. **å…·ä½“è·¯ç”±ä¼˜å…ˆ** - å›ºå®šè·¯å¾„ï¼ˆå¦‚ `/sync`ï¼‰æ”¾å‰é¢
2. **åŠ¨æ€è·¯ç”±æœ€å** - å‚æ•°è·¯ç”±ï¼ˆå¦‚ `/{id}`ï¼‰æ”¾åé¢
3. **åˆ—è¡¨è·¯ç”±å±…ä¸­** - `/` è·¯ç”±æ”¾ä¸­é—´

---

## ğŸ“ å·²ä¿®å¤çš„æ–‡ä»¶

**æ–‡ä»¶ï¼š** `backend/app/api/routes/matches.py`

**ä¿®æ”¹å‰çš„é¡ºåºï¼š**
```python
@router.get("/")                    # ä½ç½® 1
@router.get("/{match_id}")          # ä½ç½® 2 âŒ
@router.get("/sync")                # ä½ç½® 3 âŒ è¢« /{match_id} æ‹¦æˆª
@router.get("/stats/{team_id}")     # ä½ç½® 4 âŒ ä¹Ÿè¢«æ‹¦æˆª
```

**ä¿®æ”¹åçš„é¡ºåºï¼š**
```python
@router.get("/sync")                # ä½ç½® 1 âœ“ å…·ä½“è·¯ç”±
@router.get("/stats/{team_id}")     # ä½ç½® 2 âœ“ å…·ä½“è·¯ç”±
@router.get("/")                    # ä½ç½® 3 âœ“ åˆ—è¡¨è·¯ç”±
@router.get("/{match_id}")          # ä½ç½® 4 âœ“ åŠ¨æ€è·¯ç”±æœ€å
```

---

## ğŸ¯ ç°åœ¨çš„è·¯ç”±é€»è¾‘

### è¯·æ±‚åŒ¹é…æµç¨‹

```
GET /api/matches/sync?team=16610A&event=ALL
  â†“
æ£€æŸ¥ @router.get("/sync") â†’ âœ… åŒ¹é…ï¼
  â†“
è°ƒç”¨ sync_matches() å‡½æ•°
  â†“
è¿”å›ç»“æœ

GET /api/matches/stats/123
  â†“
æ£€æŸ¥ @router.get("/sync") â†’ âŒ ä¸åŒ¹é…
  â†“
æ£€æŸ¥ @router.get("/stats/{team_id}") â†’ âœ… åŒ¹é…ï¼
  â†“
è°ƒç”¨ get_team_stats(team_id=123)
  â†“
è¿”å›ç»“æœ

GET /api/matches/456
  â†“
æ£€æŸ¥ @router.get("/sync") â†’ âŒ ä¸åŒ¹é…
  â†“
æ£€æŸ¥ @router.get("/stats/{team_id}") â†’ âŒ ä¸åŒ¹é…
  â†“
æ£€æŸ¥ @router.get("/") â†’ âŒ ä¸åŒ¹é…
  â†“
æ£€æŸ¥ @router.get("/{match_id}") â†’ âœ… åŒ¹é…ï¼
  â†“
è°ƒç”¨ get_match(match_id=456)
  â†“
è¿”å›ç»“æœ
```

---

## ğŸ§ª æµ‹è¯•ä¿®å¤

### æ­¥éª¤ 1: é‡å¯åç«¯

```powershell
# åœæ­¢å½“å‰åç«¯ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
.\start.bat
```

åç«¯ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½è·¯ç”±é…ç½®ã€‚

### æ­¥éª¤ 2: æµ‹è¯• sync è·¯ç”±

**æ–¹å¼ 1: æµè§ˆå™¨ç›´æ¥è®¿é—®**
```
http://localhost:8000/api/matches/sync?team=16610A&event=ALL&scraper=robotevents
```

**æ–¹å¼ 2: ä½¿ç”¨å‰ç«¯**
1. æ‰“å¼€å‰ç«¯é¡µé¢
2. è¾“å…¥é˜Ÿä¼ç¼–å·ï¼š16610A
3. ç‚¹å‡»æœç´¢

### æ­¥éª¤ 3: æ£€æŸ¥ç»“æœ

**æˆåŠŸçš„å“åº”ï¼ˆ200 OKï¼‰ï¼š**
```json
{
  "success": true,
  "team_number": "16610A",
  "event_id": "ALL",
  "new_matches": 5,
  "updated_matches": 0,
  "total_matches": 5,
  "mock_data": true
}
```

**æµè§ˆå™¨æ§åˆ¶å°ï¼š**
```javascript
æ­£åœ¨ä» RobotEvents çˆ¬å–æœ€æ–°æ¯”èµ›æ•°æ®...
ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆæœªé…ç½® API Keyï¼‰
æˆåŠŸçˆ¬å– 5 åœºæ–°æ¯”èµ›è®°å½•!
```

**åç«¯æ—¥å¿—ï¼š**
```
INFO: 127.0.0.1:8952 - "GET /api/matches/sync?team=16610A&event=ALL&scraper=robotevents HTTP/1.1" 200 OK
```

---

## ğŸ“š FastAPI è·¯ç”±æœ€ä½³å®è·µ

### è§„åˆ™ 1: å…·ä½“è·¯å¾„ä¼˜å…ˆ

```python
# âœ… æ­£ç¡®
@router.get("/special")     # å…ˆå®šä¹‰
@router.get("/{id}")        # åå®šä¹‰

# âŒ é”™è¯¯
@router.get("/{id}")        # "special" ä¼šè¢«å½“ä½œ id
@router.get("/special")     # æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨
```

### è§„åˆ™ 2: å‚æ•°ç±»å‹éªŒè¯

```python
# âœ… å¸¦ç±»å‹éªŒè¯
@router.get("/{match_id}")
def get_match(match_id: int):  # åªæ¥å—æ•´æ•°
    pass

# å¦‚æœä¼ å…¥ "sync"ï¼ŒFastAPI ä¼šï¼š
# 1. å°è¯•è½¬æ¢ä¸º int
# 2. å¤±è´¥åè¿”å› 422
```

### è§„åˆ™ 3: ä½¿ç”¨è·¯å¾„å‰ç¼€

```python
# âœ… æ›´æ¸…æ™°çš„è®¾è®¡
@router.get("/actions/sync")    # /api/matches/actions/sync
@router.get("/stats/{team_id}") # /api/matches/stats/123
@router.get("/{match_id}")      # /api/matches/456
```

### è§„åˆ™ 4: ä½¿ç”¨ä¸åŒ HTTP æ–¹æ³•

```python
# âœ… RESTful è®¾è®¡
@router.post("/sync")           # POST ç”¨äºåˆ›å»º/åŒæ­¥
@router.get("/{match_id}")      # GET ç”¨äºè¯»å–
@router.put("/{match_id}")      # PUT ç”¨äºæ›´æ–°
@router.delete("/{match_id}")   # DELETE ç”¨äºåˆ é™¤
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æ‰€æœ‰è·¯ç”±

è®¿é—® API æ–‡æ¡£ï¼š
```
http://localhost:8000/api/docs
```

å¯ä»¥çœ‹åˆ°æ‰€æœ‰è·¯ç”±åŠå…¶é¡ºåºï¼š
```
GET /api/matches/sync
GET /api/matches/stats/{team_id}
GET /api/matches/
GET /api/matches/{match_id}
```

### æµ‹è¯•è·¯ç”±åŒ¹é…

åœ¨ FastAPI æ–‡æ¡£é¡µé¢ï¼š
1. å±•å¼€æƒ³æµ‹è¯•çš„è·¯ç”±
2. ç‚¹å‡» "Try it out"
3. å¡«å†™å‚æ•°
4. ç‚¹å‡» "Execute"
5. æŸ¥çœ‹å“åº”

### æŸ¥çœ‹é”™è¯¯è¯¦æƒ…

**422 é”™è¯¯é€šå¸¸åŒ…å«è¯¦ç»†ä¿¡æ¯ï¼š**
```json
{
  "detail": [
    {
      "loc": ["path", "match_id"],
      "msg": "value is not a valid integer",
      "type": "type_error.integer"
    }
  ]
}
```

è¿™å‘Šè¯‰æˆ‘ä»¬ï¼š
- é”™è¯¯ä½ç½®ï¼šè·¯å¾„å‚æ•° `match_id`
- é”™è¯¯åŸå› ï¼šä¸æ˜¯æœ‰æ•ˆçš„æ•´æ•°
- é”™è¯¯ç±»å‹ï¼šç±»å‹é”™è¯¯

---

## âš ï¸ å¸¸è§è·¯ç”±å†²çª

### å†²çª 1: åŠ¨æ€å‚æ•° vs å›ºå®šè·¯å¾„

```python
# âŒ å†²çª
@router.get("/{id}")
@router.get("/sync")    # æ°¸è¿œä¸ä¼šåŒ¹é…

# âœ… è§£å†³
@router.get("/sync")
@router.get("/{id}")
```

### å†²çª 2: å¤šå±‚åŠ¨æ€å‚æ•°

```python
# âŒ æ¨¡ç³Š
@router.get("/{id}/{action}")
@router.get("/{id}/details")   # å¯èƒ½å†²çª

# âœ… æ¸…æ™°
@router.get("/{id}/actions/{action}")
@router.get("/{id}/details")
```

### å†²çª 3: å¯é€‰å‚æ•° vs å›ºå®šè·¯å¾„

```python
# âŒ å¯èƒ½å†²çª
@router.get("/{id}")
@router.get("/")                # ä¸¤è€…éƒ½åŒ¹é…ç©ºè·¯å¾„

# âœ… æ˜ç¡®
@router.get("/list")
@router.get("/{id}")
```

---

## ğŸ“Š æ€§èƒ½å½±å“

**è·¯ç”±é¡ºåºå¯¹æ€§èƒ½çš„å½±å“ï¼š**

```python
# ğŸ˜Š å¥½ - å¸¸ç”¨è·¯ç”±åœ¨å‰
@router.get("/sync")        # é¢‘ç¹è°ƒç”¨
@router.get("/{id}")        # å¶å°”è°ƒç”¨

# ğŸ˜ å·® - å¸¸ç”¨è·¯ç”±åœ¨å
@router.get("/{id}")        # æ¯æ¬¡éƒ½æ£€æŸ¥
@router.get("/sync")        # å¾ˆå°‘åŒ¹é…åˆ°
```

è™½ç„¶å½±å“å¾ˆå°ï¼Œä½†åˆç†çš„é¡ºåºèƒ½ï¼š
- å‡å°‘ä¸å¿…è¦çš„æ­£åˆ™åŒ¹é…
- æé«˜è·¯ç”±è§£æé€Ÿåº¦
- è®©ä»£ç æ›´å®¹æ˜“ç†è§£

---

## âœ… éªŒè¯æ¸…å•

ä¿®å¤åéªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] `/api/matches/sync` è¿”å› 200 è€Œä¸æ˜¯ 422
- [ ] `/api/matches/stats/123` æ­£å¸¸å·¥ä½œ
- [ ] `/api/matches/` è¿”å›æ¯”èµ›åˆ—è¡¨
- [ ] `/api/matches/456` è¿”å›å•ä¸ªæ¯”èµ›
- [ ] å‰ç«¯æœç´¢é˜Ÿä¼èƒ½æˆåŠŸçˆ¬å–æ•°æ®
- [ ] API æ–‡æ¡£æ˜¾ç¤ºæ­£ç¡®çš„è·¯ç”±é¡ºåº

---

**ä¿®å¤æ—¶é—´ï¼š** 2026å¹´1æœˆ2æ—¥  
**é”™è¯¯ï¼š** 422 Unprocessable Entity  
**åŸå› ï¼š** è·¯ç”±é¡ºåºé”™è¯¯ï¼Œå…·ä½“è·¯å¾„è¢«åŠ¨æ€è·¯ç”±æ‹¦æˆª  
**è§£å†³ï¼š** è°ƒæ•´è·¯ç”±å®šä¹‰é¡ºåºï¼Œå…·ä½“è·¯ç”±ä¼˜å…ˆ  
**çŠ¶æ€ï¼š** âœ… å·²ä¿®å¤ï¼Œéœ€é‡å¯åç«¯ç”Ÿæ•ˆ
