# 🖱️ Interactive Map Clicking Feature

## 新功能：交互式地图点击绘制路径

现在你可以**直接在场地地图上点击**来添加路径点，无需手动输入坐标！

---

## ✨ 功能特性

### 1. 两种输入模式

#### 🖱️ 点击模式（默认）
- 直接在地图上点击添加路径点
- 实时预览路径和状态
- 所见即所得的设计体验

#### ⌨️ 手动输入模式
- 精确输入坐标
- 适合已知坐标的场景
- 批量导入路径点

### 2. 实时可视化
- ✅ 点击后立即显示路径点
- ✅ 虚线连接显示路径走向
- ✅ 彩色标记显示机器人状态
- ✅ 点位编号清晰可见
- ✅ 状态标签自动显示

### 3. 机器人状态标注
- 🟠 **Wing Pushing** (推翼)
- 🟢 **Intaking** (吸取)
- 🟡 **Releasing** (释放)
- 🔵 **Moving** (移动)
- ⭕ **Idle** (待机)

---

## 🚀 使用方法

### 步骤 1: 启动服务

```batch
REM 启动后端（调试模式）
debug_backend.bat

REM 启动前端（另一个终端）
cd frontend
python -m http.server 3000
```

### 步骤 2: 打开 Web 界面

访问: **http://localhost:3000**

### 步骤 3: 进入 Map 页面

点击顶部导航的 **Map** 标签

### 步骤 4: 在地图上点击绘制路径

1. **选择机器人状态**（可选）
   - 下拉菜单选择：Idle / Moving / Intaking / Wing Pushing / Releasing

2. **在地图上点击**
   - 每次点击添加一个路径点
   - 点击位置会自动标记
   - 虚线连接显示路径

3. **调整设置**
   - ✅ Show State Labels - 显示状态文字
   - ✅ Show Direction Arrows - 显示方向箭头

4. **选择渲染方法**
   - Polyline - 折线
   - Bezier Curve - 贝塞尔曲线
   - Spline - 样条曲线
   - A* Pathfinding - A* 寻路
   - Heatline - 热力线

5. **点击 "Render Path"**
   - 生成最终的高质量路径图
   - 可以下载保存

---

## 🎨 界面说明

### 左侧面板 - 配置区

```
┌─────────────────────────────┐
│ Path Configuration          │
├─────────────────────────────┤
│ Rendering Method: [Spline▼]│
│ Coordinate System: [Pixel▼]│
│                             │
│ Robot State: [Intaking▼]    │
│                             │
│ ○ Click on Map  ● Manual   │
│                             │
│ [Clear All]                 │
│                             │
│ ☑ Show State Labels         │
│ ☐ Show Direction Arrows     │
│                             │
│ Path Points List:           │
│ • Point 1: (100, 150) 🟢    │
│ • Point 2: (200, 200) 🟠    │
│ • Point 3: (300, 250) 🟡    │
│                             │
│ [Render Path]               │
└─────────────────────────────┘
```

### 右侧面板 - 地图区

```
┌─────────────────────────────┐
│ Map Preview                 │
├─────────────────────────────┤
│ 💡 Tip: Click on the map   │
│    below to add path points!│
│                             │
│ ┌───────────────────────┐   │
│ │  [VEX Field Map]      │   │
│ │                       │   │
│ │    1●─────2●          │   │
│ │    idle   intaking    │   │
│ │           │           │   │
│ │           3●──────4●  │   │
│ │      wingpush  release│   │
│ │                       │   │
│ └───────────────────────┘   │
└─────────────────────────────┘
```

---

## 💡 操作技巧

### 快速绘制路径

1. **先选状态，再点击**
   - 在 Robot State 下拉菜单中选择状态
   - 然后在地图上点击
   - 该点会自动带上状态标记

2. **连续添加相同状态**
   - 选中一个状态后
   - 可以连续点击多个点
   - 所有点都会有相同状态

3. **混合使用**
   - 部分点设置状态
   - 部分点不设置
   - 灵活标注关键动作点

### 删除和编辑

- **删除单个点**: 点击路径点列表中的 `×` 按钮
- **清空所有点**: 点击 `Clear All` 按钮
- **重新开始**: 点击渲染后的 `Edit Path` 按钮

### 坐标系统

- **Pixel** (像素): 直接使用图片像素坐标 (0-600)
- **Field** (场地): 使用场地实际坐标 (mm, 0-3600)

---

## 🎮 实战示例

### VEX Pushback 自动阶段路径

```
场景：15秒自动阶段策略
目标：吸取3个三角球并得分

步骤：
1. 选择 "Idle" 状态，点击起始位置
2. 选择 "Moving" 状态，点击移动路径
3. 选择 "Intaking" 状态，点击第一个球位置
4. 选择 "Moving" 状态，点击移动到第二个球
5. 选择 "Intaking" 状态，点击第二个球位置
6. 选择 "Wing Pushing" 状态，点击推翼区域
7. 选择 "Moving" 状态，点击移动到得分区
8. 选择 "Releasing" 状态，点击得分区域
9. 选择 "Idle" 状态，点击结束位置
10. 选择 "Spline" 渲染方法
11. 点击 "Render Path"
```

结果：生成一张完整的比赛策略路径图！

---

## 🎨 可视化效果

### Canvas 预览（点击时）
- **路径点**: 彩色圆圈 + 编号
- **连接线**: 红色虚线
- **状态标签**: 黑底彩字
- **实时更新**: 每次点击立即显示

### 最终渲染（点击 Render）
- **高质量曲线**: 平滑的路径
- **状态图标**: 专业的状态标记
- **文字标签**: 清晰的状态说明
- **方向箭头**: 路径方向指示（可选）

---

## 🔧 技术细节

### 前端实现
- **HTML5 Canvas** - 交互式绘图
- **事件监听** - 鼠标点击捕获
- **坐标转换** - Canvas 坐标映射
- **实时渲染** - 立即视觉反馈

### 后端处理
- **PathRenderer** - 路径渲染引擎
- **5种算法** - 多种绘制方法
- **状态叠加** - 机器人状态标注
- **图片导出** - PNG 格式输出

---

## 📋 坐标对应关系

### 像素坐标系 (Pixel)
```
(0,0) ───────────────────► X
  │
  │  [VEX Field Map]
  │
  │
  ▼
  Y

范围: (0, 0) to (600, 600)
```

### 场地坐标系 (Field)
```
(0,0) ───────────────────► X
  │
  │  [3600mm × 3600mm]
  │
  │
  ▼
  Y

范围: (0, 0) to (3600, 3600) mm
```

---

## ⚙️ 配置选项

### style 配置
```javascript
{
    "color": "#FF0000",          // 路径颜色
    "width": 3,                  // 路径宽度
    "opacity": 0.8,              // 透明度
    "arrow": true,               // 显示箭头
    "show_state_labels": true,   // 显示状态标签
    "state_icon_size": 20        // 状态图标大小
}
```

---

## 🐛 故障排查

### 地图不显示？
- 检查 `pushback_map.png` 是否存在
- 如果不存在，会显示网格背景
- 可以继续使用，不影响功能

### 点击无反应？
- 确保选择了 "Click on Map" 模式
- 检查 Console 是否有错误
- 刷新页面重试

### 渲染失败？
- 确保 Backend 正在运行
- 检查至少添加了 2 个点
- 查看浏览器 Console 错误信息

---

## 🎯 最佳实践

1. **关键点标注**
   - 不是每个点都需要状态
   - 只在关键动作点添加状态
   - 保持路径清晰易读

2. **合理间距**
   - 点与点之间保持适当距离
   - 太密集影响可读性
   - 太稀疏路径不准确

3. **渲染方法选择**
   - **Polyline**: 快速简单
   - **Bezier**: 平滑美观
   - **Spline**: 最佳效果（推荐）
   - **A***: 需要避障时使用

4. **坐标系选择**
   - **开发测试**: 使用 Pixel
   - **实际应用**: 使用 Field

---

## 📸 截图示例

### 点击模式
```
┌────────────────────────────────┐
│ 💡 Click on the map to add    │
│    path points!                │
├────────────────────────────────┤
│  [Map with cursor]             │
│                                │
│     ✋ Click here              │
│                                │
│  Path builds as you click!     │
└────────────────────────────────┘
```

### 渲染结果
```
┌────────────────────────────────┐
│  [Beautiful rendered path]     │
│                                │
│  ●────●────●────●────●         │
│  idle  🟢  🟠  🟡  idle       │
│                                │
│ [Edit Path]  [Download]        │
└────────────────────────────────┘
```

---

## 🔄 版本更新

**v1.2.0** - 2026-01-02
- ✨ 新增交互式地图点击功能
- ✨ 实时路径预览
- ✨ Canvas 绘图支持
- ✨ 两种输入模式切换
- ✨ 点位可视化编号
- ✨ 状态颜色实时显示
- ✨ 渲染结果下载功能

**v1.1.0** - 2026-01-02
- ✨ 机器人状态标注功能
- ✨ 5 种状态类型支持

---

## 📚 相关文档

- **ROBOT_STATE_FEATURE.md** - 机器人状态功能详细说明
- **QUICKSTART_ROBOT_STATES.md** - 快速开始指南
- **API_EXAMPLES.md** - API 使用示例
- **README.md** - 项目总体说明

---

## 💬 反馈和支持

如有问题或建议，请：
1. 查看相关文档
2. 检查 Console 错误
3. 查看 `BUGFIX_SUMMARY.md`

---

**享受可视化路径设计的乐趣！** 🎉🤖
