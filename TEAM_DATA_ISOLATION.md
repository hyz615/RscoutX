# 🔄 队伍数据隔离功能说明

## 更新内容 (2026年1月2日)

### ✅ 新功能：按队伍分离 Auton 数据

现在系统会为每个队伍单独保存和加载数据，实现完全隔离：

## 功能详情

### 1. **队伍级别存储**

每个队伍的数据独立保存：
```javascript
// 存储键格式
rscoutx_team_12345  // 队伍 ID 12345 的数据
rscoutx_team_67890  // 队伍 ID 67890 的数据
rscoutx_last_team_id  // 记住上次查看的队伍
```

### 2. **保存的数据内容**

每个队伍保存：
- ✅ 所有 Auton 路径和路径点
- ✅ 当前选中的 Auton 索引
- ✅ 机器人类型选择
- ✅ 机翼配置状态
- ✅ 驾驶员习惯笔记
- ✅ 保存时间戳

### 3. **自动切换机制**

**场景 1：搜索新队伍**
```
用户输入队伍编号 → 搜索队伍信息 → 自动加载该队伍的保存数据
```

**场景 2：队伍有保存数据**
- 加载之前绘制的 Auton 路径
- 恢复机器人配置
- 恢复驾驶员笔记
- 显示提示："已加载队伍 XXX 的保存数据"

**场景 3：队伍无保存数据**
- 重置为默认状态
- 空白 Auton 路径
- 无机器人类型选择
- 空白驾驶员笔记

### 4. **数据自动保存**

在以下操作后自动保存当前队伍数据（1 秒防抖）：
- ✅ 绘制/删除 Auton 路径点
- ✅ 切换 Auton
- ✅ 添加/删除 Auton
- ✅ 选择机器人类型
- ✅ 修改机翼配置
- ✅ 输入驾驶员笔记
- ✅ 清空路径

## 使用示例

### 示例 1：多队伍分析工作流

```
1. 搜索队伍 12345A
   → 绘制 3 个 Auton 路径
   → 选择机器人类型：竞赛机器人
   → 备注："驾驶稳定，Auton 精确"
   → 自动保存

2. 搜索队伍 67890B
   → 系统自动重置（显示空白状态）
   → 绘制 2 个 Auton 路径
   → 选择机器人类型：路边机器人
   → 备注："激进打法"
   → 自动保存

3. 再次搜索队伍 12345A
   → 自动恢复之前的 3 个 Auton 路径
   → 恢复机器人类型和所有笔记
   → 提示："已加载队伍 12345A 的保存数据"
```

### 示例 2：清除特定队伍数据

```
1. 搜索队伍 12345A
2. 点击 "🗑️ 清除保存数据" 按钮
3. 确认对话框："确定要清除队伍 12345A 的所有保存数据吗？"
4. 确认后：
   → 删除该队伍的所有保存数据
   → 重置为空白状态
   → 其他队伍的数据不受影响
```

## 技术实现

### 存储结构
```javascript
// LocalStorage 键值对
{
  "rscoutx_team_1": {
    "teamId": 1,
    "autons": [...],
    "currentAutonIndex": 0,
    "selectedRobotType": "cbot",
    "hasWing": true,
    "driverNotes": "...",
    "timestamp": "2026-01-02T10:30:00.000Z"
  },
  "rscoutx_team_2": {
    "teamId": 2,
    "autons": [...],
    // ...
  },
  "rscoutx_last_team_id": "1"
}
```

### 核心函数

**保存数据**
```javascript
saveData()
// 仅在有当前队伍时保存
// 使用队伍 ID 作为存储键
// 1秒防抖避免频繁保存
```

**加载数据**
```javascript
loadTeamData(teamId)
// 加载指定队伍的数据
// 如果没有数据则重置为默认
// 更新记住的上次队伍 ID
```

**重置状态**
```javascript
resetToDefaults()
// 清空所有 Auton
// 取消机器人类型选择
// 清空笔记
// 重绘画布
```

## 优势

### ✅ 数据隔离
- 每个队伍的数据完全独立
- 切换队伍时自动切换数据
- 不会混淆不同队伍的信息

### ✅ 自动化
- 无需手动保存/加载
- 切换队伍自动处理
- 1秒防抖减少保存次数

### ✅ 用户友好
- 清晰的提示消息
- 确认对话框防止误删
- 控制台日志便于调试

### ✅ 性能优化
- LocalStorage 本地存储，速度快
- 防抖机制避免频繁写入
- 按需加载，不影响启动速度

## 兼容性

### 浏览器支持
- ✅ Chrome/Edge (推荐)
- ✅ Firefox
- ✅ Safari
- ✅ Opera

### LocalStorage 限制
- 每个域名通常有 5-10MB 限制
- 估算：每个队伍约 10-50KB
- 可存储约 100-500 个队伍的数据

## 调试信息

打开浏览器控制台（F12）可以看到：

```
✓ Data auto-saved for Team 12345 at 10:30:15
✓ Loaded saved data for Team 12345
ℹ️ No saved data for Team 67890, using defaults
✓ Saved data cleared for Team 12345
```

## 注意事项

### ⚠️ 数据持久性
- LocalStorage 数据存储在浏览器中
- 清除浏览器缓存会删除所有数据
- 建议定期使用 "💾 下载所有 Auton 图片" 备份

### ⚠️ 跨设备
- 数据不会跨设备同步
- 每个浏览器独立存储
- 无云端备份功能

### ⚠️ 隐私
- 所有数据本地存储
- 不会上传到服务器
- 清除数据可删除所有痕迹

## 未来改进建议

### 可能的增强功能
1. **导入/导出功能**
   - 导出所有队伍数据为 JSON
   - 导入之前备份的数据
   - 跨浏览器迁移数据

2. **数据库同步**
   - 可选将数据保存到后端数据库
   - 团队成员共享数据
   - 云端备份

3. **数据统计**
   - 查看已保存队伍列表
   - 存储空间使用情况
   - 批量管理功能

---

**更新时间：** 2026年1月2日  
**版本：** v2.0  
**功能状态：** ✅ 已实现并测试
